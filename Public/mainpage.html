<!--
     Title: ECE Senior Design Project Code - blank page
     Description: This file is used for copying and pasting purposes only when we are creating a new page and want
     to start from a blank page
     Authors: Chris Varriano
     Will Van Luven
     Sean McNamara
     Arai Singleton
     Date created: 9/28/20
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Welcome to Canvas Calendar</title>
        
        
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
              integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
        

        <!-- Add icon library -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <!-- TEDDY EDIT - mainpage stylesheet -->
        <link rel="stylesheet" href="/css/mainpage.css">

        <meta name="google-signin-client_id" content="967496995343-hbeqhlnlithe3prp8nh2sv2bj8f836p7.apps.googleusercontent.com">

        <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>

        <!-- TEDDY EDIT - Multiple firebase init() and declarations?? -->
        <!-- initialize the SDK after all desired features are loaded -->
        <!-- <script defer src="/__/firebase/init.js"></script> -->
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-app.js"></script>
        <!-- TODO: Add SDKs for Firebase products that you want to use
             https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-database.js"></script>


        <!-- update the version number as needed -->
        <!-- <script defer src="/__/firebase/7.21.1/firebase-app.js"></script> -->
        <!-- include only the Firebase features as you need -->
        <script defer src="/__/firebase/7.21.1/firebase-auth.js"></script>
        <script defer src="/__/firebase/7.21.1/firebase-database.js"></script>
        <script defer src="/__/firebase/7.21.1/firebase-messaging.js"></script>
        <script defer src="/__/firebase/7.21.1/firebase-storage.js"></script>
        <script defer src="/__/firebase/7.21.1/firebase-analytics.js"></script>
        <script defer src="/__/firebase/7.21.1/firebase-remote-config.js"></script>
        <script defer src="/__/firebase/7.21.1/firebase-performance.js"></script>
        <!-- initialize the SDK after all desired features are loaded -->
        <!-- <script defer src="/__/firebase/init.js"></script> -->
        <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.1/fullcalendar.css' rel='stylesheet' />
        <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css' rel='stylesheet' /> 
        <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.1/fullcalendar.min.js'></script>


        <!-- Be Very Careful When Sourcing Raw Files From Github!
             Even though it is the raw file, the content-type is sent as "text/plain" and not "application/javascript" so sourcing from github will load a text file and not javascript.
             However, you can paste the "raw.github" link at "https://raw.githack.com/" and that website will host the raw file for you and send the file with the correct type.

             Example : To do a quick check to see a file's content-type in web transit, run a "curl -I {}" request

             $ curl -sI "https://raw.githubusercontent.com/sydcanem/bootstrap-contextmenu/master/bootstrap-contextmenu.js" | grep -i "content-type:"
             response : content-type: text/plain; charset=utf-8

             $curl -sI "https://rawcdn.githack.com/sydcanem/bootstrap-contextmenu/ac9f6a035b97dbe8958f8f2925fe4bdaa8a192c2/bootstrap-contextmenu.js" | grep -i "content-type:"
             response : content-type: application/javascript; charset=utf-8 -->

        <!-- <script src='https://raw.githubusercontent.com/sydcanem/bootstrap-contextmenu/master/bootstrap-contextmenu.js'></script> -->
        <script src='https://rawcdn.githack.com/sydcanem/bootstrap-contextmenu/ac9f6a035b97dbe8958f8f2925fe4bdaa8a192c2/bootstrap-contextmenu.js'></script>


        <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>



        <!-- TEDDY EDIT  -->
        <!-- + Button Loader Plugin -->
        <!-- + adding locally sourced UDCanvasAPI here... -->
        <script src="/js/jquery.buttonLoader2.js"></script>
        <script src="/js/UDCanvasAPI.js"></script>
        <!-- <script src="/js/parseAllCourses.js"></script> -->
        <!-- <script src="/js/getTerm.js"></script> -->
        <script src="/js/testFile.js"></script>
        <style>
         * {
             padding:0;
             margin:0;
         }

         :root{
             --eventColor:#808080;
         }

         .fc-event {
             padding:1em 0.5em !important;
             background-color:red;
         }

         .fc-day-grid-event .fc-content {
             white-space:normal !important;
         }
         .strikeout * {
             text-decoration: line-through !important;
         }

         .fc-title{
             color: #f4f4f4;
         }

         .topSection{
             margin-top: 1in;
             padding-left: 50px;
             padding-right: 50px;
         }



         /* header _________________________________________*/

         a {
             color: rgb(255, 255, 255);
         }

         .header {
             background-color: var(--eventColor);
             box-shadow: 1px 1px 4px 0 rgba(0,0,0,.1);
             position: fixed;
             left:0;
             right:0;
             top:0;
             width: 100%;
             z-index: 3;
         }

         .header ul {
             margin: 0;
             padding: 0;
             list-style: none;
             overflow: hidden;
             background-color: var(--eventColor);
         }

         .header li a {
             display: block;
             padding: 20px 20px;
             border-right: 1px solid #f4f4f4;
             text-decoration: none;
         }

         .header li a:hover,
         .header .menu-btn:hover {
             background-color:lightgrey;
         }

         .header .logo {
             display: block;
             float: left;
             font-size: 2em;
             padding: 10px 20px;
             text-decoration: none;
         }

         /* menu */

         .header .menu {
             clear: both;
             max-height: 0;
             transition: max-height .2s ease-out;
         }

         /* menu icon */

         .header .menu-icon {
             cursor: pointer;
             display: inline-block;
             float: right;
             padding: 28px 20px;
             position: relative;
             user-select: none;
         }

         .header .menu-icon .navicon {
             background: #333;
             display: block;
             height: 2px;
             position: relative;
             transition: background .2s ease-out;
             width: 18px;
         }

         .header .menu-icon .navicon:before,
         .header .menu-icon .navicon:after {
             background: #333;
             content: '';
             display: block;
             height: 100%;
             position: absolute;
             transition: all .2s ease-out;
             width: 100%;
         }

         .header .menu-icon .navicon:before {
             top: 5px;
         }

         .header .menu-icon .navicon:after {
             top: -5px;
         }

         /* menu btn */

         .header .menu-btn {
             display: none;
         }

         .header .menu-btn:checked ~ .menu {
             max-height: 240px;
         }

         .header .menu-btn:checked ~ .menu-icon .navicon {
             background: transparent;
         }

         .header .menu-btn:checked ~ .menu-icon .navicon:before {
             transform: rotate(-45deg);
         }

         .header .menu-btn:checked ~ .menu-icon .navicon:after {
             transform: rotate(45deg);
         }

         .header .menu-btn:checked ~ .menu-icon:not(.steps) .navicon:before,
         .header .menu-btn:checked ~ .menu-icon:not(.steps) .navicon:after {
             top: 0;
         }

         /* 48em = 768px */

         @media (min-width: 48em) {
             .header li {
                 float: left;
             }
             .header li a {
                 padding: 20px 30px;
             }
             .header .menu {
                 clear: none;
                 float: right;
                 max-height: none;
             }
             .header .menu-icon {
                 display: none;
             }
         }

         /*Button*/
         .refresh-btn {
             background-color: var(--eventColor);
             border: none;
             color: white;
             padding: 15px 15px;
             font-size: 25px;
             cursor: pointer;
         }

         /* Darker background on mouse-over */
         .refresh-btn:hover {
             color: rgb(30, 192, 30);
         }   


         #headerImage
         {
             cursor: pointer;
             padding-top: 5px;
             width: 60px;
             height: 60px;
             overflow: hidden;
             -webkit-border-radius: 50%;
             -moz-border-radius: 50%;
             -ms-border-radius: 50%;
             -o-border-radius: 50%;
             border-radius: 50%;
         }
         
         
         /*Popup*/
         /* The Modal (background) */
         .modal {
             display: none; /* Hidden by default */
             position: fixed; /* Stay in place */
             margin-left: auto;
             margin-right: auto;
             z-index: 99 !important;
             padding-top: 200px; /* Location of the box */
             left: 0;
             top: 0;
             width: 500px; /* Full width */
             height: 750px; /* Full height */
             overflow: auto; /* Enable scroll if needed */
         }

         /* Modal Content */
         .modal-content {
             background-color:lightgrey;
             margin: auto;
             padding: 20px;
             border: 1px solid #888;
             width: 80%;
             display: flex;
             justify-content: center;
         }

         /* The Close Button */
         .close {
             color: #ff0000;
             float: left;
             font-size: 28px;
             font-weight: bold;
         }

         .close:hover,
         .close:focus {
             color: #000;
             text-decoration: none;
             cursor: pointer;
         }

         h1 {
             font-weight: bold;
             font-size: 15px;
         }

         .user-message-title{
             font-weight: bold;
             font-size: 50px;
         }


         .button {
             display: inline-block;
             border-radius: 10px;
             background-color: #c42700;
             border: none;
             color: #FFFFFF;
             text-align: center;
             font-size: 15px;
             padding: 5px;
             width: 200px;
             transition: all 0.5s;
             cursor: pointer;
             margin: 5px;
             margin-left: 75px;
         }


         .button:hover {
             box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
         }

         .past div.fc-time, .past div.fc-title {
             text-decoration: line-through;
         }

        /*Table*/
         table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }

        /*Table spacing
        .container {
            display: flex;
            float: left;
            padding-left: 50px;
            width: 100%;
            height: 100%;
        }
        .container > div {
            flex: 1; 
        }
        .time-management-table{
            padding-top: 50px;
        }
        */
.container {
  width: 100%;
  height: 100%;
  float: left;
  
}

.col-container {
  widows: auto;
  height: auto;
  display: flex;
  flex-direction: row;
  padding-left: 33px;
  padding-top: 50px;
  padding-bottom: 50px;
 
}
.col-1 {
  flex: 1 1 50%;
}

.col-2 {
  flex: 1 1 20%;
  padding-left: 925px;
}
.table3 {
    padding-right: 50px;
    float: right;
}
        </style>
    </head>
    <body>
        <header class="header">
            <image id="headerImage" src=""/>
            <a style="color: white;" href="" class="logo" id="headerlogo">Welcome Back!!</a>
            <input class="menu-btn" type="checkbox" id="menu-btn" />
            <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
            <ul class="menu">
                <li><a style="color: white;" href='https://canvas-calendar-4ea54.web.app/profilepage.html'>Profile</a></li>
                <li><a style="color: white;" href="#contact" onclick="logoutFunction()">Logout</a></li>
                <li><button id="refresh-btn" class="refresh-btn has-spinner"><i class="fa fa-refresh"></i></button></li>
            </ul>
        </header>

        <div class="topSection">

            <div id="myModal" class="modal">

                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div id="user-message-title" style="font-size: 30px;"></div>
                    <h1>Start:</h1>
                    <div id="user-message-start"></div>
                    <h1>End:</h1>
                    <div id="user-message-end"></div>
                    <h1>Description:</h1>
                    <div id="user-message-description" style="padding-bottom: 20px;"></div>
                    <button class="button" id=deleteBtn style="vertical-align:middle"><span>Delete Event </span></button>
                </div>
            </div>

            <span><input type='color' id='colorPicker'></span>
            <div id='calendar'></div>
        </div>

        <!-- Your custom menu with dropdown-menu as default styling -->
        <div id="context-menu">
            <ul class="dropdown-menu" role="menu">
                <li><a tabindex="-1">Action</a></li>
                <li><a tabindex="-1">Another action</a></li>
                <li><a tabindex="-1">Something else here</a></li>
                <li class="divider"></li>
                <li><a tabindex="-1">Separated link</a></li>
            </ul>
        </div>

        <div class="col-container">
        
            <div class="col-1" float="left">
                <div class="card" style="width: 1000px;"> 
                    <div class="card-header" style="width: 1000px;">
                        <h4>Manage Your Assignments</h4> 
                    </div>
                        <table>
                            <tr>
                                <th>Assignment</th>
                                <th>Status</th>
                                <th>Due Date</th>
                                <th>Recommended Start Time</th>
                                <th>Time Set</th>
                            </tr>
                            <tr>
                                <td id="assignment1"></td>
                                <td id="status1"></td>
                                <td id="duedate1"></td>
                                <td id="start1"></td>
                                <td id="timeset1"></td>
                            </tr>
                            <tr>
                                <td id="assignment2"></td>
                                <td id="status2"></td>
                                <td id="duedate2"></td>
                                <td id="start2"></td>
                                <td id="timeset2"></td>
                            </tr>
                            <tr>
                                <td id="assignment3"></td>
                                <td id="status3"></td>
                                <td id="duedate3"></td>
                                <td id="start3"></td>
                                <td id="timeset3"></td>
                            </tr>
                            <tr>
                                <td id="assignment4"></td>
                                <td id="status4"></td>
                                <td id="duedate4"></td>
                                <td id="start4"></td>
                                <td id="timeset4"></td>
                            </tr>
                            <tr>
                                <td id="assignment5"></td>
                                <td id="status5"></td>
                                <td id="duedate5"></td>
                                <td id="start5"></td>
                                <td id="timeset5"></td>
                            </tr>
                            <tr>
                                <td id="assignment6"></td>
                                <td id="status6"></td>
                                <td id="duedate6"></td>
                                <td id="start6"></td>
                                <td id="timeset6"></td>
                            </tr>
                            <tr>
                                <td id="assignment7"></td>
                                <td id="status7"></td>
                                <td id="duedate7"></td>
                                <td id="start7"></td>
                                <td id="timeset7"></td>
                            </tr>
                            <tr>
                                <td id="assignment8"></td>
                                <td id="status8"></td>
                                <td id="duedate8"></td>
                                <td id="start8"></td>
                                <td id="timeset8"></td>
                            </tr>
                            <tr>
                                <td id="assignment9"></td>
                                <td id="status9"></td>
                                <td id="duedate9"></td>
                                <td id="start9"></td>
                                <td id="timeset9"></td>
                            </tr>
                            <tr>
                                <td id="assignment10"></td>
                                <td id="status10"></td>
                                <td id="duedate10"></td>
                                <td id="start10"></td>
                                <td id="timeset10"></td>
                            </tr>
                            <tr>
                                <td id="assignment11"></td>
                                <td id="status11"></td>
                                <td id="duedate11"></td>
                                <td id="start11"></td>
                                <td id="timeset11"></td>
                            </tr>
                            <tr>
                                <td id="assignment12"></td>
                                <td id="status12"></td>
                                <td id="duedate12"></td>
                                <td id="start12"></td>
                                <td id="timeset12"></td>
                            </tr>
                            <tr>
                                <td id="assignment13"></td>
                                <td id="status13"></td>
                                <td id="duedate13"></td>
                                <td id="start13"></td>
                                <td id="timeset13"></td>
                            </tr>
                            <tr>
                                <td id="assignment14"></td>
                                <td id="status14"></td>
                                <td id="duedate14"></td>
                                <td id="start14"></td>
                                <td id="timeset14"></td>
                            </tr>
                            <tr>
                                <td id="assignment15"></td>
                                <td id="status15"></td>
                                <td id="duedate15"></td>
                                <td id="start15"></td>
                                <td id="timeset15"></td>
                            </tr>
                            
                        
                        </table>
                </div>
            </div>
             
            <div class="col-2" float="left">
                <div class="card" style="width: 260px;"> 
                    <div class="card-header" style="width: 260px;">
                        <h4><a style="color: black;" href="https://canvas-calendar-4ea54.web.app/coursespage.html">Active Courses</a></h4> 
                    </div>
                    <ul id="active_courses" class="list-group list-group-flush">
                        <!-- <li class="list-group-item"><a style="color: rgb(0, 0, 0);" href="https://canvas-calendar-4ea54.web.app/coursespage.html">CPEG 499</a></li> -->
                        <!-- <li class="list-group-item"><a style="color: rgb(0, 0, 0);" href="https://canvas-calendar-4ea54.web.app/coursespage.html">CPEG 495</a></li> -->
                        <!-- <li class="list-group-item"><a style="color: rgb(0, 0, 0);" href="https://canvas-calendar-4ea54.web.app/coursespage.html">ELEG 491</a></li> -->
                        <!-- <li class="list-group-item"><a style="color: rgb(0, 0, 0);" href="https://canvas-calendar-4ea54.web.app/coursespage.html">LEAD 158</a></li> -->
                        <!-- <li class="list-group-item"></li> -->
                    </ul>
                </div>
            </div>
        </div>  

        <!--
            <div class="table3" float="right"> 
                <div class="card" style="width: 260px;"> 
                    <div class="card-header" style="width: 260px;">
                        <h4>Assignments</h4> 
                    </div>
                    <ul id="assignments" class="list-group list-group-flush">
                        
                    </ul>
                </div>
            </div>
        -->

        <script>

         // Your web app's Firebase configuration
         // For Firebase JS SDK v7.20.0 and later, measurementId is optional
         var firebaseConfig = {
             apiKey: "AIzaSyAWlmVBGiPNaZ8q6wIW8qj4MHhRCdEnzfw",
             authDomain: "canvas-calendar-4ea54.firebaseapp.com",
             databaseURL: "https://canvas-calendar-4ea54.firebaseio.com",
             projectId: "canvas-calendar-4ea54",
             storageBucket: "canvas-calendar-4ea54.appspot.com",
             messagingSenderId: "967496995343",
             appId: "1:967496995343:web:87bdb9b3571033cfce897a",
             measurementId: "G-2GBWCBTD5W"
         };
         // Initialize Firebase
         firebase.initializeApp(firebaseConfig);
         firebase.analytics();

         var a1 = "question-mark2.png"
         var image = document.getElementById("headerImage");
         image.src = a1;

         // events array
         var eventsArray = new Array();
         var eventsAssignmentsArray = new Array();

         //event click popup variables
         // Get the modal
         var modal = document.getElementById("myModal");

         // Get the <span> element that closes the modal
         var span = document.getElementsByClassName("close")[0];

         // Logout Code _________________________________________________
         $(document).ready(function () {
             $("#registerForm").on("submit", function (event) {
                 event.preventDefault();
                 var fname = $("#registerFirstName").val();
                 var lname = $("#registerLastName").val();
                 var email = $("#registerEmail").val();
                 var password = $("#registerPassword").val();
                 firebase.auth().createUserWithEmailAndPassword(email, password)
                         .then(function (user) {
                             firebase.database().ref().child("users/" + user.user.uid).set({
                                 firstname: fname,
                                 lastname: lname,
                                 email: user.user.email,
                                 role: "user"
                             })
                             alert("Account successfuly created")
                         })
                         .catch(function (err) {
                             console.log(err);
                             alert(err);
                         });
             });


             $("#loginForm").on("submit", function (event) {
                 event.preventDefault();
                 var email = $("#loginEmail").val();
                 var password = $("#loginPassword").val();
                 firebase.auth().signInWithEmailAndPassword(email, password)
                         .then(function (user) {
                             console.log(user);
                             location.reload();
                             alert("Welcome Back!")
                         })
                         .catch(function (err) {
                             console.log(err);
                             alert(err);
                         });
             });

             $("#logoutbtn").on("click", function () {
                 firebase.auth().signOut().then(function () {
                     alert("Goodbye!");
                     location.reload();
                 })
                         .catch(function (error) {
                             console.log(err);
                             alert(err);
                         });
             });

             firebase.auth().onAuthStateChanged(function (user) {
                 if (user) {
                     console.log(user);
                     var email = user.email;
                     document.getElementById("headerlogo").innerHTML = "Welcome Back, " + user.email;
                     /* alert("Welcome " + email); */

                     /* TEDDY EDIT - After verifying user is logged in, add the user's firebase data */
                     user_data = getUserData();
                     (async() => {
                         console.log("waiting for variable");
                         while(!user_data.hasOwnProperty("api_key")) // define the condition as you like
                             await new Promise(resolve => setTimeout(resolve, 1000));
                         console.log("variable is defined");
                         /* testFunction(); */
                         console.log(getTerm(Date.now()));
                         
                         parseAllCourses(user_data);
                         parseActiveCourses(user_data);
                         parseSchoolAttending(user_data);
                         //addEventsBackIntoArray(user_data);
                         displayAssignmentEvents(user_data);
                         addEventsBackIntoArray(user_data);
                         displayEvents(user_data);
                         
                     })();
                 } else {
                     // No user is signed in.
                     console.log("No user");
                     //alert("Currently logged out");
                 }
             });
         });

         var accountType = sessionStorage.getItem("accountType");
         function logoutFunction(){
             if(accountType == "Google"){
                 signOut();
             }
             else{
                 firebase.auth().signOut().then(function () {
                     location.reload();
                     window.location.href = 'https://canvas-calendar-4ea54.web.app/index.html'//put url here
                 })
                         .catch(function (error) {
                             console.log(err);
                             alert(err);
                         });
             }
         }

         function signOut() { //Sign Out Function
             gapi.auth2.getAuthInstance().signOut().then(function() {
                 console.log('User signed out')
                 window.location.href = 'https://canvas-calendar-4ea54.web.app/index.html'//put url here
             })
         }

         function onLoad() {
             gapi.load('auth2', function() {
                 gapi.auth2.init();
             });
         }

         // calendar Code ________________________________________________________________________

         function addEventsBackIntoArray(user_data){ 
             var calendarDataToBeAdded = user_data["events"];
             if(calendarDataToBeAdded[0] != null){
                 for(var i=0; i<=(calendarDataToBeAdded.length-1); i++){
                     console.log(calendarDataToBeAdded.length);
                     console.log(calendarDataToBeAdded[i]);
                     if(calendarDataToBeAdded[i] != null){
                         eventsArray.push(calendarDataToBeAdded[i]);
                     }   
                     else{
                         console.log("no events exist");
                     }
                 }
             }
             else{
               console.log("no events exist");
             }
         }

         $('#calendar').fullCalendar({
             header: {
                 left: 'prev,next today',
                 center: 'title',
                 right: 'month,agendaWeek,agendaDay'
             },
             //defaultDate: '2015-02-12',
             selectable: true,
             selectHelper: true,
             navLinks: true, // can click day/week names to navigate views
             editable: true,
             eventLimit: true,
             /*
                eventRender: function(event, element) {
                console.log(event);

                var html = '<a data-event-id="' + event.id + '" class="' + ((event.strikeout) ? 'strikeout' : '') + ' fc-day-grid-event fc-h-event fc-event fc-start fc-end fc-draggable">';
                html += '<div class="fc-content">';
                html += ' <label><input type="checkbox" ' + ((event.strikeout) ? 'checked' : '') + '> <span class="fc-time">'  + '</span> ';
                html += ' <span class="fc-title">' + event.title + '</span>';
                html += '</label></div></a>';

                var $event = $(html);

                addRightClickMenu($event);

                return $event;
                },
              */
             select: function(start, end) {
                 var title = prompt('Event Title:');
                 var description = prompt('Event Description:');
                 //var start = prompt("Event Start Time:")
                 var eventData;
                 if (title) {
                     eventData = {
                         title: title,
                         start: start,
                         end: end, 
                         description: description,
                         color: $("#colorPicker").val()
                     };
                     $("#calendar").fullCalendar("renderEvent", eventData, true); // stick? = true
                 }
                 $('#calendar').fullCalendar('unselect');
                 eventsArray.push(eventData);
                 addEventsToDatabase(eventsArray);
             },
             
             eventClick: function(calEvent, jsEvent) {
                 modal.style.display = "block";
                 var displayTitle = calEvent.title;
                 var displayStart = calEvent.start;
                 var displayEnd = calEvent.end;
                 var displayDescription = calEvent.description;
                 //var displayColor = calEvent.color;
                 displayEventDataInPopup(displayTitle, displayStart, displayEnd, displayDescription);
                 //deleteEventsFromDatabase(displayTitle, displayStart, displayEnd, displayDescription, displayColor);
             },

             eventRender: function(event, element) {
                 element.append( "<span class='closeon'>X</span>" );
                 element.find(".closeon").click(function(calEvent, jsEvent) {
                     $('#calendar').fullCalendar('removeEvents',event._id);
                     //console.log(calEvent.description);
                     //var userId   = firebase.auth().currentUser.uid;
                     //var database = firebase.database();
                     //database.ref('users/' + userId).update({
                     //    assignment_events: assignment_events
                     //}).then(function() {
                 });
                 //});
             },
             
             
             /*
                eventClick: function(calEvent, jsEvent) {
                var title = prompt("Edit Event Content:", calEvent.title);
                calEvent.title = title;
                $("#calendar").fullCalendar("updateEvent", calEvent);
                },
              */
             //events: [{id:1, strikeout:false, title: 'Event #1', start: '2015-02-05T12:00:00'}, {id: 2, strikeout:false, title: 'Event #2', start: '2015-02-07'}]
         });
         
         function createAssignmentEvents(assignments){
             $.each(assignments, function(i, assignment) {
                 var eventData;
                 var title = assignment["name"];
                 var start = assignment["due_at"];
                 var end = assignment["due_at"];
                 var description = assignment["description"];
                 if(start != null){
                     console.log(title); 
                     console.log(start);
                     console.log(end);
                     if(title){
                         eventData = {
                             title: title,
                             start: start,
                             end: end,
                             description: description,
                             color: '#FF0000'
                         }
                     } 
                     eventsAssignmentsArray.push(eventData);
                     addAssignmentEventsToDatabase(eventsAssignmentsArray);
                 }
                 else{
                     console.log("function failed")
                 }
             });
         }
         
         function addAssignmentEventsToDatabase(eventsAssignmentsArray){
             console.log(eventsAssignmentsArray);
             var assignment_events = eventsAssignmentsArray;
             var userId   = firebase.auth().currentUser.uid;
             var database = firebase.database();
             database.ref('users/' + userId).update({
                 assignment_events: assignment_events
             }).then(function() {
                 
             });
         }

         function addEventsToDatabase(eventsArray){
             //console.log(title);
             console.log(eventsArray);
             var events = eventsArray;
             //var event_data = eventData;
             var userId   = firebase.auth().currentUser.uid;
             var database = firebase.database();

             database.ref('users/' + userId).update({
                 events: events
             }).then(function() {
                 
             });
         } 
        
        
         function displayEvents(user_data){
             var calendarData = user_data["events"];
             console.log(calendarData);
             for(var i=0; i<=(calendarData.length-1); i++){
                 $("#calendar").fullCalendar("renderEvent", calendarData[i], true); // render events
             }
         }

         function displayAssignmentEvents(user_data){
             var assignmentEventData = user_data["assignment_events"];
             console.log(assignmentEventData);
             for(var i=0; i<=(assignmentEventData.length-1); i++){
                 $("#calendar").fullCalendar("renderEvent", assignmentEventData[i], true); // render events
             }
         }
         /*   
         function displayEvents(user_data){
             var calendarData = user_data["events"];
             var assignmentEventData = user_data["assignment_events"];
             for(var i=0; i<=assignmentEventData.length; i++){
                 $("#calendar").fullCalendar("renderEvent", assignmentEventData[i], true); // render events
             }
             for(var j=0; j<=calendarData.length; j++){
                 $("#calendar").fullCalendar("renderEvent", calendarData[j], true); // render events
             }
         }
         */

         //when clicked
         function displayEventDataInPopup(displayTitle, displayStart, displayEnd, displayDescription){
             var showTitle = displayTitle;
             var showStart = displayStart;
             var showEnd = displayEnd;
             var showDescription = displayDescription;
             document.getElementById("user-message-title").innerHTML = showTitle;
             document.getElementById("user-message-start").innerHTML = showStart;
             document.getElementById("user-message-end").innerHTML = showEnd;
             document.getElementById("user-message-description").innerHTML = showDescription;
             
         }


         /*
            select: function(start, end) {
            var title = prompt('Event Title:');
            if (title) {
            $('#calendar').fullCalendar('renderEvent', {
            title: title, start: start, end: end
            }, true);
            }
            $('#calendar').fullCalendar('unselect');
            },
            editable: true,*/
         //events: [{id:1, strikeout:false, title: 'Event #1', start: '2015-02-05T12:00:00'}, {id: 2, strikeout:false, title: 'Event #2', start: '2015-02-07'}]


         function addRightClickMenu($event){
             $event.contextmenu({
                 target: '#context-menu',
                 onItem: function (context, e) {
                     console.log(context);

                     var event = $("#calendar").fullCalendar( 'clientEvents', [context.data('event-id')])[0];

                     alert($(e.target).text() + ' for event "' + event.title + '"');
                 }
             });
         }


         $('#calendar').on('change', ':checkbox', function(){
             var event = $("#calendar").fullCalendar( 'clientEvents', [$(this).parents('.fc-event:first').data('event-id')])[0];
             event.strikeout = $(this).is(':checked');
             $("#calendar").fullCalendar('renderEvent', event, true);
         });

         //$("#deleteBtn").on("click", function () {
         //   modal.style.display = "none";
         //});
         
         /*   
            function deleteEventsFromDatabase(displayTitle, displayStart, displayEnd, displayDescription, displayColor){
            console.log("in delete function");
            var eventToDelete 
            var title = displayTitle;
            var start = displayStart;
            var end = displayEnd;
            var description = displayDescription;
            var color = displayColor;
            $("#deleteBtn").on("click", function () {
            modal.style.display = "none";
            if(title){
            eventToDelete = {
            title: title,
            start: start,
            end: end,
            description: description,
            color: color
            }
            for(var i=0; i<=eventsArray.length; i++){
            for(var j=0; j<=eventsAssignmentsArray.length; j++){
            if(eventToDelete == eventsArray[i] || eventsAssignmentsArray[j]){
            database.ref('users/' + userId).update({
            events: events
            }).then(function() {
            });
            }
            }
            }
            }
            });
            }
          */
         //get school attending

         function parseSchoolAttending(user_data) {
             var college = user_data["school_attending"]
             console.log(college);
             displaySchoolDesign(college);
         }

         //display school design 

         function displaySchoolDesign(college){
             var school = college;
             console.log(school);
             if(school == "UniversityOfDelaware"){
                 document.body.style.setProperty('--eventColor',"#00539f");
                 a1 = "delaware-logo.png";
                 image = document.getElementById("headerImage");
                 image.src = a1;
             }
             else if(school == "UniversityOfMaryland"){
                 document.body.style.setProperty('--eventColor',"#ff0000");
                 a1 = "umd_logo.png";
                 image = document.getElementById("headerImage");
                 image.src = a1;
             }
             else if(school == "SyracuseUniversity"){
                 document.body.style.setProperty('--eventColor',"#FF6C00");
                 a1 = "syracuse.jpg";
                 image = document.getElementById("headerImage");
                 image.src = a1;
             }
             else{
                 document.body.style.setProperty('--eventColor',"#808080");
             }
         }

         function getTerm(datetime) {
             /* Determine the academic term using the courses datetime.
              *
              *  Args:
              *      Required - datetime (str) - the datetime string when the course started
              *  Returns:
              *      JSON Object - {term: "21F", year: 2021}
              */
             var d = new Date(datetime);
             var y = d.getFullYear();
             var yy = JSON.stringify(d.getFullYear()).slice(2,4);
             var term;

             if ((d.getMonth() > 0) && (d.getMonth() < 6)) {
                 term = yy+"S";
             } else {
                 term = yy+"F";
             }
             var data = {
                 term: term,
                 year: y,
                 month: d.getMonth(),
                 day: d.getDay()
             };
             return data;
         }

         function parseAllCourses(user_data) {
             var all_courses = $("#all_courses");

             $.each(user_data["courses"], function (i, e) {
                 var course_term = getTerm(e["start_at"]);
                 var course_name = e["name"];
                 var course_url = "https://udel.instructure.com/courses/"+e["course_id"];

                 console.log(course_name);
                 var li = document.createElement('li');
                 var a = document.createElement('a');
                 li.setAttribute("class", "list-group-item");
                 a.setAttribute("style", "color: rgb(0, 0, 0);");
                 a.setAttribute("href", course_url);
                 a.innerHTML = course_name;

                 li.appendChild(a);
                 all_courses.append(li);
             });
         }

         function parseActiveCourses(user_data) {
             var active_courses = $("#active_courses");
             var today = getTerm(Date.now());

             $.each(user_data["courses"], function (i, course) {
                 var course_term = getTerm(course["start_at"]);
                 var course_name = course["name"];
                 var course_url = "https://udel.instructure.com/courses/"+course["course_id"];

                 console.log(course_term["year"], today["year"])

                 if ((today["year"] === course_term["year"]) || (course_name.includes(today["term"]))) {
                     console.log(course_name);
                     var li = document.createElement('li');
                     var a = document.createElement('a');
                     li.setAttribute("class", "list-group-item");
                     a.setAttribute("style", "color: rgb(0, 0, 0);");
                     a.setAttribute("href", course_url);
                     a.innerHTML = course_name;

                     li.appendChild(a);
                     active_courses.append(li);

                     if (course["assignments"]) {
                         parseAssignments(course["assignments"]);
                         createAssignmentEvents(course["assignments"]);
                         setTimeManagementSystem(course["assignments"]);
                     }
                 }
             });
         }

         function parseAssignments(assignments) {
             var assignments_div = $("#assignments");

             $.each(assignments, function(i, assignment) {
                 var assignment_name = assignment["name"];
                 var assignment_url = assignment["html_url"];

                 console.log(assignment);

                 var li = document.createElement('li');
                 var a = document.createElement('a');

                 li.setAttribute("class", "list-group-item");
                 a.setAttribute("style", "color: rgb(0, 0, 0);");
                 a.setAttribute("href", assignment_url);
                 a.innerHTML = assignment_name;

                 li.appendChild(a);
                 assignments_div.append(li);

                 
             });
         }
         
         //time management system______________________________
         var k = 0; // table position count variable

        function setTimeManagementSystem(assignments){
             $.each(assignments, function(i, assignment) {
                var name = assignment["name"];
                var duedate = assignment["due_at"];
                var start = assignment["due_at"];
                var time = assignment["task_hours"];
                var suggestion = assignment["suggested_time"];
                
                //date stuff
                var currentdate = new Date().toJSON().slice(0, 10);
                var dueDateDay = duedate.slice(2,4);
                dueDateDay = dueDateDay.replace('/', '');
                dueDateDay = parseInt(dueDateDay);
                var dueDateMonth = "0"+duedate.slice(0,1);
                dueDateMonth = parseInt(dueDateMonth);
                var todayMonth = currentdate.slice(5,7);
                todayMonth = parseInt(todayMonth);
                var todayDay = currentdate.slice(8);
                todayDay = parseInt(todayDay);
                
                var availableTimes = user_data["available_times"];


                //tests
                //console.log(name);
                //console.log(dueDateMonth);
                //console.log(dueDateDay);
                //console.log(todayMonth);
                //console.log(todayDay);

                if((dueDateMonth==todayMonth)||(dueDateMonth==(todayMonth+1))){
                    k++; // next spot on table
                    console.log(name)
                    console.log("due date current - displaying on table spot"+k)
                    console.log("______________________________________________")
                    //set time to start
                    if((dueDateDay-time)>=1){
                        var startDay = dueDateDay-time;
                        //start = dueDateMonth + "/" + startDay + "/" + "2021, 11:59 PM";
                        start = dueDateMonth + "/" + startDay + "/" + "2021, " + suggestion;
                    }
                    else{
                        var x = Math.abs(dueDateDay-time);
                        startDay = 30-x;
                        //start = (dueDateMonth-1) + "/" + startDay + "/" + "2021, 11:59 PM";
                        start = (dueDateMonth-1) + "/" + startDay + "/" + "2021, " + suggestion;
                    }
                    

                    var setAssignmentCell = "assignment"+k;
                    var setDueDateCell = "duedate"+k;
                    var setStartCell = "start"+k;
                    var setTimeCell = "timeset"+k;
                    var setStatusCell = "status"+k;
                
                    if(duedate != null){
                        document.getElementById(setAssignmentCell).innerHTML = name;
                        document.getElementById(setDueDateCell).innerHTML = duedate;
                        document.getElementById(setStartCell).innerHTML = start;
                        document.getElementById(setTimeCell).innerHTML = time + " Hours";
                    
                        if(dueDateMonth<todayMonth){
                            document.getElementById(setStatusCell).innerHTML = "<span style='color: green;' style='font-size: bold'>Finished!</span>";
                        }
                        else if(dueDateMonth==todayMonth && dueDateDay<todayDay){
                            document.getElementById(setStatusCell).innerHTML = "<span style='color: green;' style='font-size: bold'>Finished!</span>";
                        }
                        /*(todayDay<=dueDateDay<(todayDay+7))*/
                        else if(dueDateMonth==todayMonth && dueDateDay<(todayDay+7) && todayDay<dueDateDay){
                            document.getElementById(setStatusCell).innerHTML = "<span style='color: red;' style='font-size: bold'>Due Date Approcahing Soon</span>";
                        }
                        else if(dueDateMonth==todayMonth && dueDateDay==todayDay){
                            document.getElementById(setStatusCell).innerHTML = "<span style='color: red;' style='font-size: bold'>Due Date Approcahing Soon</span>";
                        }
                        else{
                            document.getElementById(setStatusCell).innerHTML = "<span style='color: #d5b60a;' style='font-size: bold'>In Progress</span>";
                        }       
                    
                    }
                    
                }
                else{
                    console.log(name)
                    console.log("nothing to display - assignments past")
                    console.log("________________________________________")
                }        
          });
        }

         //pop up code
         // When the user clicks on <span> (x), close the modal
         span.onclick = function() {
             modal.style.display = "none";
         }

         // When the user clicks anywhere outside of the modal, close it
         window.onclick = function(event) {
             if (event.target == modal) {
                 modal.style.display = "none";
             }
         }
        </script>

        <!-- TEDDY EDIT  -->
        <!-- + Logged In User Data from Firebase DB -->
        <!-- + Refresh Button Snippet -->
        <script src="/js/userData.js"></script>
        <script src="/js/refreshButton.js"></script>

    </body>
</html>
